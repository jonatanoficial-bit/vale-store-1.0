<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Administração • Vale Games Store</title>
    <meta name="description" content="Painel administrativo do Vale Games Store (0 custo): produtos, pedidos, entregas, cupons e configurações." />
    <meta name="theme-color" content="#5b2be0" />
    <link rel="manifest" href="manifest.webmanifest" />
    <link rel="icon" href="assets/logo.png" />
    <link rel="stylesheet" href="css/styles.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
      integrity="sha512-K5m0d+vBL3Ghq4c40M+3L7B5q5RqRGmH8F0aQK2FOpmswHEQAFAJK2b4Z7vdq7pQigz3hbzF/HJT6TwA24TV1Q=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap"
      rel="stylesheet"
    />
  </head>
  <body>
    <header class="admin-header">
      <h1>Área do Administrador</h1>
      <button id="logoutBtn" class="button secondary hidden">
        <i class="fa-solid fa-sign-out-alt"></i> Sair
      </button>
    </header>
    <main class="admin-container">
      <!-- Tela de login -->
      <section id="loginSection" class="login-section">
        <h2>Login</h2>
        <form id="loginForm">
          <label for="adminPassword">Senha de Administrador:</label>
          <input
            type="password"
            id="adminPassword"
            required
            placeholder="Digite sua senha"
          />
          <button type="submit" id="loginBtn" class="button primary">Entrar</button>
        </form>
      </section>
      <!-- Tela principal de administração -->
      <section id="adminSection" class="hidden">
        <div class="admin-actions">
          <button id="addProductBtn" class="button primary">
            <i class="fa-solid fa-plus"></i> Adicionar App
          </button>
          <button id="exportDataBtn" class="button secondary">
            <i class="fa-solid fa-download"></i> Exportar Dados
          </button>
          <button id="importDataBtn" class="button secondary">
            <i class="fa-solid fa-upload"></i> Importar Dados
          </button>
          <button id="exportBackupBtn" class="button secondary">
            <i class="fa-solid fa-box-archive"></i> Backup completo
          </button>
        </div>

        <div class="segmented" role="tablist" aria-label="Seções do admin">
          <button class="segmented-btn" data-tab="dashboard" type="button">
            <i class="fa-solid fa-gauge-high"></i> Dashboard
          </button>
          <button class="segmented-btn is-active" data-tab="products" type="button">
            <i class="fa-solid fa-box"></i> Produtos
          </button>
          <button class="segmented-btn" data-tab="orders" type="button">
            <i class="fa-solid fa-bag-shopping"></i> Pedidos
          </button>
          <button class="segmented-btn" data-tab="deliveries" type="button">
            <i class="fa-solid fa-key"></i> Entregas
          </button>
          <button class="segmented-btn" data-tab="coupons" type="button">
            <i class="fa-solid fa-ticket"></i> Cupons
          </button>
          <button class="segmented-btn" data-tab="sales" type="button">
            <i class="fa-solid fa-chart-line"></i> Vendas
          </button>
          <button class="segmented-btn" data-tab="settings" type="button">
            <i class="fa-solid fa-gear"></i> Config
          </button>
        </div>

        <input type="file" id="importFileInput" class="hidden" accept="application/json" />

        <div id="tab-dashboard" class="tab-panel hidden">
          <div class="panel-head">
            <h3>Dashboard executivo</h3>
            <p class="muted">Resumo operacional (0 custo): pedidos, entregas, receita estimada e top apps.</p>
          </div>
          <div id="dashboardGrid" class="dash-grid"></div>
          <div class="card" style="padding:16px; margin-top:12px">
            <h4 style="margin:0 0 10px">Mensagens prontas (WhatsApp)</h4>
            <p class="muted" style="margin:0 0 10px">
              Copie e cole no WhatsApp para agilizar suporte e entrega.
            </p>
            <div class="dash-actions">
              <button id="copyMsgPurchaseBtn" class="button secondary" type="button">
                <i class="fa-solid fa-copy"></i> Copiar mensagem (código de compra)
              </button>
              <button id="copyMsgDeliveryBtn" class="button secondary" type="button">
                <i class="fa-solid fa-copy"></i> Copiar mensagem (código de entrega)
              </button>
            </div>
            <p class="muted" style="margin:10px 0 0">Dica: você pode personalizar os textos no arquivo <code>content/manifest.json</code> (campo <code>support.message</code>).</p>
          </div>

          <div class="dash-split">
            <div class="card" style="padding:14px">
              <h4 class="card-title" style="margin:0 0 10px">Top produtos</h4>
              <div id="dashTopProducts" class="dash-list"></div>
            </div>
            <div class="card" style="padding:14px">
              <h4 class="card-title" style="margin:0 0 10px">Atalhos de operação</h4>
              <div class="dash-actions">
                <a class="button secondary" href="deliver.html" target="_blank" rel="noreferrer"><i class="fa-solid fa-key"></i> Abrir Entrega</a>
                <a class="button secondary" href="library.html" target="_blank" rel="noreferrer"><i class="fa-solid fa-book"></i> Abrir Biblioteca</a>
                <a class="button secondary" href="install.html" target="_blank" rel="noreferrer"><i class="fa-solid fa-mobile-screen"></i> Guia APK</a>
              </div>
              <p class="muted" style="margin:10px 0 0">Dica: use “Backup completo” antes de atualizações.</p>
            </div>
          </div>
        </div>

        <div id="tab-products" class="tab-panel">
          <div id="productsList" class="admin-list"></div>
        </div>

        <div id="tab-orders" class="tab-panel hidden">
          <div class="panel-head">
            <h3>Pedidos (checkout)</h3>
            <p class="muted">
              Aqui aparecem os códigos que o cliente gerou após pagar. Você confirma o pagamento e libera a entrega.
            </p>
            <div class="card" style="padding:12px; margin-top:12px">
              <div style="display:flex; gap:10px; flex-wrap:wrap; align-items:flex-end; justify-content:space-between;">
                <div style="min-width:240px; flex:1">
                  <label class="muted" for="backendSecret" style="display:block; margin-bottom:6px">Admin Secret (somente para operar o Worker)</label>
                  <input id="backendSecret" type="password" placeholder="Cole o ADMIN_SECRET do Worker" />
                </div>
                <div style="min-width:220px">
                  <label class="muted" for="backendOrdersFilter" style="display:block; margin-bottom:6px">Filtro</label>
                  <select id="backendOrdersFilter">
                    <option value="all">Todos</option>
                    <option value="created">Criados</option>
                    <option value="paid">Pagos</option>
                    <option value="expired">Expirados</option>
                  </select>
                </div>
                <div style="display:flex; gap:8px; flex-wrap:wrap">
                  <button id="ordersModeLocal" class="button secondary" type="button"><i class="fa-solid fa-desktop"></i> Local</button>
                  <button id="ordersModeBackend" class="button secondary" type="button"><i class="fa-solid fa-cloud"></i> Backend</button>
                  <button id="refreshBackendOrders" class="button primary" type="button"><i class="fa-solid fa-rotate"></i> Atualizar</button>
                </div>
              </div>
              <p class="muted" style="margin:10px 0 0">
                Dica: se <code>API_BASE</code> estiver configurado, você consegue listar e operar pedidos direto do Worker (0 custo). Se não estiver, use o modo Local.
              </p>
            </div>

            <div class="card" style="padding:12px; margin-top:12px">
              <h4 style="margin:0 0 8px">Criar pedido manual (venda via WhatsApp)</h4>
              <p class="muted" style="margin:0 0 10px">Cria um pedido no backend e (opcional) já marca como pago para gerar o link de entrega automaticamente.</p>
              <div style="display:flex; gap:10px; flex-wrap:wrap; align-items:flex-end">
                <div style="min-width:220px; flex:1">
                  <label class="muted" for="manualOrderProduct" style="display:block; margin-bottom:6px">Produto</label>
                  <select id="manualOrderProduct"></select>
                </div>
                <label style="display:flex; gap:8px; align-items:center; padding:10px 12px; border-radius:12px; background:rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.10)">
                  <input id="manualOrderMarkPaid" type="checkbox" />
                  <span class="muted">Marcar como pago e gerar entrega</span>
                </label>
                <button id="createBackendOrderBtn" class="button primary" type="button">
                  <i class="fa-solid fa-plus"></i> Criar pedido
                </button>
              </div>
            </div>
          </div>
          <div id="ordersList" class="admin-list"></div>
          <div id="backendOrdersList" class="admin-list hidden"></div>
        </div>

        <div id="tab-deliveries" class="tab-panel hidden">
          <div class="panel-head">
            <h3>Cofre de entregas</h3>
            <p class="muted">
              Códigos liberados que destravam Android/iOS/Web na página <code>deliver.html</code>.
            </p>
          </div>
          <div class="admin-actions" style="margin-top: 12px">
            <button id="addDeliveryBtn" class="button secondary" type="button">
              <i class="fa-solid fa-plus"></i> Criar entrega manual
            </button>
            <button id="clearDeliveriesBtn" class="button secondary" type="button">
              <i class="fa-solid fa-trash"></i> Limpar cofre
            </button>
          </div>
          <div id="deliveriesList" class="admin-list"></div>
        </div>

        <div id="tab-coupons" class="tab-panel hidden">
          <div class="panel-head">
            <h3>Cupons</h3>
            <p class="muted">
              Crie cupons de desconto para campanhas. Funciona 100% local (0 custo),
              mas já prepara a estrutura para automação no futuro.
            </p>
          </div>
          <div class="admin-actions" style="margin-top: 12px">
            <button id="addCouponBtn" class="button primary" type="button">
              <i class="fa-solid fa-plus"></i> Novo cupom
            </button>
            <button id="clearCouponsBtn" class="button secondary" type="button">
              <i class="fa-solid fa-trash"></i> Limpar cupons
            </button>
            <button id="exportManifestBtn" class="button secondary" type="button">
              <i class="fa-solid fa-file-export"></i> Exportar manifest.json
            </button>
          </div>
          <div id="couponsList" class="admin-list"></div>
        </div>

        <div id="tab-sales" class="tab-panel hidden">
          <div id="salesList" class="admin-list">
            <h3>Vendas (registro local)</h3>
            <ul id="salesUl"></ul>
          </div>
        </div>

        <div id="tab-settings" class="tab-panel hidden">
          <div class="panel-head">
            <h3>Configurações</h3>
            <p class="muted">
              Como o projeto roda 100% no navegador, a senha do admin fica salva em <code>localStorage</code>.
              Use uma senha forte. Se você esquecer, basta limpar o storage do navegador.
            </p>
          </div>

          <div class="card" style="padding:16px; margin-top: 12px">
            <h4 style="margin:0 0 10px">Trocar senha do Admin</h4>
            <form id="changePassForm" class="form">
              <label class="field">
                <span class="label">Senha atual</span>
                <input id="passCurrent" type="password" autocomplete="current-password" required />
              </label>
              <label class="field">
                <span class="label">Nova senha</span>
                <input id="passNew" type="password" autocomplete="new-password" minlength="6" required />
              </label>
              <label class="field">
                <span class="label">Confirmar nova senha</span>
                <input id="passNew2" type="password" autocomplete="new-password" minlength="6" required />
              </label>
              <button class="button primary" type="submit">
                <i class="fa-solid fa-key"></i> Atualizar senha
              </button>
              <p id="passMsg" class="muted" style="margin:10px 0 0"></p>
            </form>
          </div>
        </div>
      </section>
      <!-- Modal de produto -->
      <div id="productModal" class="modal hidden">
        <div class="modal-content">
          <span class="close" id="closeModal">&times;</span>
          <h2 id="modalTitle">Novo App</h2>
          <form id="productForm">
            <input type="hidden" id="productId" />
            <label for="productName">Nome do App</label>
            <input type="text" id="productName" required />
            <label for="productDescription">Descrição</label>
            <textarea id="productDescription" rows="3" required></textarea>
            <label for="productPrice">Preço (R$)</label>
            <input type="number" id="productPrice" min="0" step="0.01" required />
            <label for="productAndroid">URL Android (.apk)</label>
            <input type="url" id="productAndroid" required />
            <label for="productWeb">Link Web/PC (Vercel/GitHub)</label>
            <input type="url" id="productWeb" placeholder="https://..." />
            <label for="productIOS">Link iOS (GitHub/Vercel)</label>
            <input type="url" id="productIOS" />
            <label for="productPayLink">Link de Pagamento (Ton/PagBank/etc.)</label>
            <input type="url" id="productPayLink" placeholder="https://..." />
            <label for="productImage">Imagem</label>
            <input type="file" id="productImage" accept="image/*" />
            <div class="modal-actions">
              <button type="submit" class="button primary">Salvar</button>
              <button type="button" id="cancelBtn" class="button secondary">Cancelar</button>
            </div>
          </form>
        </div>
      </div>

      <!-- Modal de cupom -->
      <div id="couponModal" class="modal hidden">
        <div class="modal-content">
          <span class="close" id="closeCouponModal">&times;</span>
          <h2 id="couponModalTitle">Criar cupom</h2>
          <form id="couponForm">
            <input type="hidden" id="couponIndex" />
            <label for="couponCode">Código</label>
            <input type="text" id="couponCode" placeholder="EX: BEMVINDO10" required />

            <label for="couponType">Tipo</label>
            <select id="couponType" required>
              <option value="percent">Percentual (%)</option>
              <option value="fixed">Valor fixo (R$)</option>
            </select>

            <label for="couponValue">Valor</label>
            <input type="number" id="couponValue" min="0" step="0.01" required />

            <label for="couponExpires">Validade (opcional)</label>
            <input type="date" id="couponExpires" />

            <label class="checkbox-row">
              <input type="checkbox" id="couponActive" checked />
              <span>Ativo</span>
            </label>

            <div class="modal-actions">
              <button type="submit" class="button primary">Salvar cupom</button>
              <button type="button" id="cancelCouponBtn" class="button secondary">Cancelar</button>
            </div>
          </form>
        </div>
      </div>

      <!-- Modal de entrega manual -->
      <div id="deliveryModal" class="modal hidden">
        <div class="modal-content">
          <span class="close" id="closeDeliveryModal">&times;</span>
          <h2 id="deliveryModalTitle">Criar entrega</h2>
          <form id="deliveryForm">
            <label for="deliveryCodeInput">Código de entrega (opcional)</label>
            <input type="text" id="deliveryCodeInput" placeholder="Deixe vazio para gerar automaticamente" />

            <label for="deliveryAndroid">URL Android (APK)</label>
            <input type="url" id="deliveryAndroid" placeholder="https://..." />

            <label for="deliveryIOS">Link iOS</label>
            <input type="url" id="deliveryIOS" placeholder="https://..." />

            <label for="deliveryWeb">Link Web/PC</label>
            <input type="url" id="deliveryWeb" placeholder="https://..." />

            <label for="deliveryNote">Mensagem/observação</label>
            <textarea id="deliveryNote" rows="3" placeholder="Ex: Obrigado pela compra!"></textarea>

            <div class="modal-actions">
              <button type="submit" class="button primary">Salvar entrega</button>
              <button type="button" id="cancelDeliveryBtn" class="button secondary">Cancelar</button>
            </div>
          </form>
        </div>
      </div>

      <!-- Modal de cupom -->
      <div id="couponModal" class="modal hidden">
        <div class="modal-content">
          <span class="close" id="closeCouponModal">&times;</span>
          <h2 id="couponModalTitle">Novo cupom</h2>
          <form id="couponForm">
            <input type="hidden" id="couponIndex" />

            <label for="couponCode">Código</label>
            <input type="text" id="couponCode" placeholder="EX: BEMVINDO10" required />

            <label for="couponType">Tipo</label>
            <select id="couponType" required>
              <option value="percent">Percentual (%)</option>
              <option value="fixed">Valor fixo (R$)</option>
            </select>

            <label for="couponValue">Valor</label>
            <input type="number" id="couponValue" min="0" step="0.01" required />

            <label for="couponExpires">Validade (opcional)</label>
            <input type="date" id="couponExpires" />

            <label class="checkbox-row">
              <input type="checkbox" id="couponActive" checked />
              <span>Ativo</span>
            </label>

            <div class="modal-actions">
              <button type="submit" class="button primary">Salvar</button>
              <button type="button" id="cancelCouponBtn" class="button secondary">Cancelar</button>
            </div>
          </form>
        </div>
      </div>
    </main>
    <script src="js/config.js"></script>
    <script src="js/admin.js"></script>
    <script src="js/pwa.js"></script>
  </body>
</html>